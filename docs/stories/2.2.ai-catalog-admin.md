# Story 2.2: ai-catalog-admin

## Status
Approved

## Story
**As an** administrator,
**I want** to manage the AI services catalog through CRUD operations and content curation,
**so that** I can maintain a high-quality, relevant collection of approved AI tools for teachers

## Acceptance Criteria
1. AI Catalog Management доступно в админ панели через отдельную навигацию
2. Таблица всех AI сервисов с возможностью сортировки, поиска и фильтрации
3. CRUD операции: создание нового AI сервиса через форму
4. Редактирование существующих сервисов с preview изменений
5. Деактивация/активация сервисов (soft delete для безопасности)
6. Bulk operations: массовое управление статусом сервисов
7. Управление subject taxonomy (добавление/редактирование предметов)
8. Upload и управление иконками/изображениями для сервисов
9. Preview mode для просмотра сервиса глазами учителя
10. Модерация workflow: draft → review → published статусы
11. Analytics по использованию сервисов (клики, популярность)
12. Import/Export функциональность для bulk управления каталогом

## Tasks / Subtasks
- [ ] Интеграция в админ панель (AC: 1)
  - [ ] Добавить "AI Catalog" в admin navigation
  - [ ] Создать admin catalog layout
  - [ ] Настроить admin routing для catalog management
  - [ ] Интегрировать с существующей admin auth

- [ ] Таблица управления сервисами (AC: 2, 11)
  - [ ] Создать AdminServiceTable с pagination
  - [ ] Добавить search и filtering по статусу/предмету
  - [ ] Реализовать sorting по дате/популярности
  - [ ] Показать usage analytics в таблице

- [ ] CRUD операции (AC: 3, 4, 5)
  - [ ] Создать ServiceForm для add/edit
  - [ ] Реализовать service creation workflow
  - [ ] Добавить edit mode с change tracking
  - [ ] Implement soft delete с confirmation dialogs

- [ ] Bulk operations (AC: 6, 12)
  - [ ] Массовое изменение статусов
  - [ ] Bulk subject assignment
  - [ ] CSV import/export functionality
  - [ ] Progress indicators для bulk operations

- [ ] Content management (AC: 7, 8, 9)
  - [ ] Subject taxonomy management UI
  - [ ] Image upload с preview и optimization
  - [ ] Service preview mode (teacher view)
  - [ ] Rich text editor для descriptions

- [ ] Workflow management (AC: 10)
  - [ ] Draft/Review/Published status system
  - [ ] Approval workflow для new services
  - [ ] Change history tracking
  - [ ] Notification system для workflow events

- [ ] Analytics и reporting (AC: 11)
  - [ ] Service usage statistics
  - [ ] Popular services dashboard
  - [ ] Subject usage analytics
  - [ ] Export analytics reports

## Dev Notes

### Архитектурный контекст
- **Integration:** Extends Story 1.5 admin panel
- **Data Model:** ServiceCatalogEntry CRUD + Subject taxonomy
- **File Storage:** Supabase Storage для service images
- **Analytics:** Custom analytics или simple usage tracking

### Database Schema Extensions
ServiceCatalogEntry enhancements:
- `status` - enum: 'draft' | 'review' | 'published' | 'archived'
- `created_by`, `updated_by` - admin user references
- `usage_count` - tracking popularity
- `image_url` - service icon/screenshot
- `review_notes` - moderation feedback

Subject taxonomy table:
- `subjects` table with hierarchy support
- Many-to-many с ServiceCatalogEntry

### Admin UI Components
Key components для catalog management:
- AdminServiceTable (extends existing admin table patterns)
- ServiceForm (rich form с validation)
- ImageUploadWidget
- BulkActionToolbar
- ServicePreviewModal
- SubjectTaxonomyManager

### Technical Implementation
#### Form Validation:
```javascript
const serviceSchema = z.object({
  name: z.string().min(3).max(100),
  description: z.string().min(10).max(500),
  access_url: z.url(),
  subjects: z.array(z.string()).min(1),
  category: z.enum(['writing', 'analysis', 'research', 'presentation']),
  status: z.enum(['draft', 'review', 'published'])
});
```

#### Image Management:
- Supabase Storage bucket для service images
- Image optimization (resize, compress)
- Fallback images для сервисов без иконок

#### Workflow System:
- Status transitions с validation
- Email notifications (future enhancement)
- Change audit log

### Subject Taxonomy Strategy
Иерархическая структура:
```
Точные науки
  ├── Математика
  ├── Физика
  └── Химия
Гуманитарные
  ├── История
  ├── Литература
  └── Иностранные языки
```

### Dependencies
- `@hookform/resolvers/zod` - form validation
- `react-dropzone` - file uploads
- `@tiptap/react` - rich text editor (опционально)
- Custom image optimization utilities

### Performance Considerations
- Virtual scrolling для больших каталогов
- Image lazy loading в admin table
- Debounced search в admin interface
- Optimistic updates для quick operations

### Testing

#### Admin Catalog Testing Requirements
- CRUD operations: 100% coverage (data integrity критично)
- File upload functionality: все форматы и edge cases
- Bulk operations: stress testing с большими datasets
- Workflow transitions: все возможные state changes

#### Security Testing
- Admin authorization для всех операций
- File upload security (type validation, size limits)
- Input sanitization для rich content
- CSRF protection для form submissions

#### Integration Testing
- Admin panel navigation integration
- Service preview accuracy (admin vs user view)
- Analytics data consistency
- Export/import data integrity

#### E2E Admin Catalog Flow:
```javascript
test('Complete admin catalog management flow', async ({ page }) => {
  // 1. Login as admin
  // 2. Navigate to AI catalog management
  // 3. Create new AI service
  // 4. Upload service icon
  // 5. Set subjects and metadata
  // 6. Preview service as teacher would see
  // 7. Publish service
  // 8. Verify service appears in user catalog
  // 9. Check analytics tracking
});

test('Bulk catalog management', async ({ page }) => {
  // 1. Select multiple services
  // 2. Bulk status change
  // 3. Export catalog data
  // 4. Import modified data
  // 5. Verify all changes applied correctly
});
```

#### Content Management Testing
- Rich text content rendering
- Image upload и optimization
- Subject taxonomy management
- Workflow state transitions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-25 | 1.0 | Initial story creation for AI catalog admin management | Sarah (PO) |

## Dev Agent Record
_(This section is populated by the development agent during implementation)_

### Agent Model Used
_(Заполняется dev-agent)_

### Debug Log References
_(Заполняется dev-agent)_

### Completion Notes List
_(Заполняется dev-agent)_

### File List
_(Заполняется dev-agent)_

## QA Results
_(Results from QA Agent QA review of the completed story implementation)_