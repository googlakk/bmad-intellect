# Story 1.2: auth-setup

## Status
Approved

## Story
**As a** teacher,
**I want** to securely log into the educational platform using my credentials,
**so that** I can access my personalized learning journey and AI tools catalog

## Acceptance Criteria
1. Страница входа реализована согласно front-end-spec (двухколоночная карточка с фото и формой)
2. Форма входа содержит поля Email и Password с валидацией
3. Supabase Auth интегрирован для обработки аутентификации
4. Кнопка "Войти" работает с hover эффектами согласно UI/UX спецификации
5. Ссылка "Забыли пароль?" функциональна с email reset
6. Переключатель тем (Солнце/Луна) работает в правом верхнем углу
7. После успешного входа показывается анимированный лоадер с обратной связью
8. Система определяет статус пользователя (новый/возвращающийся) и роль
9. Новые пользователи перенаправляются на персонализированный экран "Инициация"
10. Возвращающиеся пользователи с незавершенным курсом идут в "Обучающий центр"
11. Пользователи с завершенным курсом попадают в "Главный хаб"
12. Обработка ошибок аутентификации с понятными, поддерживающими сообщениями

## Tasks / Subtasks
- [ ] Создание страницы входа (AC: 1, 6)
  - [ ] Реализовать двухколоночную карточку layout
  - [ ] Добавить качественное фото для левой колонки
  - [ ] Создать форму входа в правой колонке
  - [ ] Интегрировать переключатель тем (солнце/луна)

- [ ] Реализация формы аутентификации (AC: 2, 4)
  - [ ] Создать поля Email и Password с валидацией
  - [ ] Добавить кнопку "Войти" с hover эффектами
  - [ ] Реализовать client-side валидацию форм
  - [ ] Добавить состояния loading/disabled для формы

- [ ] Интеграция Supabase Auth (AC: 3, 5)
  - [ ] Настроить Supabase Auth клиент
  - [ ] Реализовать login функциональность
  - [ ] Добавить функцию "Забыли пароль?" с email reset
  - [ ] Настроить auth state management с Zustand

- [ ] Анимированный лоадер (AC: 7)
  - [ ] Создать компонент анимированного лоадера
  - [ ] Добавить анимацию контуров мозга и книги
  - [ ] Реализовать пульсирующие оранжевые линии
  - [ ] Показывать лоадер после успешного входа

- [ ] Логика определения пользователя (AC: 8, 9, 10, 11)
  - [ ] Создать сервис определения статуса пользователя
  - [ ] Реализовать проверку завершения курса
  - [ ] Настроить роутинг для новых пользователей
  - [ ] Настроить роутинг для возвращающихся пользователей

- [ ] Обработка ошибок (AC: 12)
  - [ ] Создать компоненты для отображения ошибок
  - [ ] Реализовать понятные error messages
  - [ ] Добавить поддерживающий тон в сообщениях
  - [ ] Протестировать различные сценарии ошибок

## Dev Notes

### Архитектурный контекст
- **Аутентификация:** Supabase Auth как BaaS решение
- **State Management:** Zustand для auth state, React Query для user data
- **UI Framework:** Radix UI + Tailwind CSS согласно tech stack
- **Роутинг:** Next.js App Router для navigation logic

### UI/UX Requirements из front-end-spec.md
#### Страница входа (Сценарий 1, п.1):
- **Layout:** Широкая горизонтальная карточка в центре, две колонки
- **Левая колонка:** Качественное профессиональное фото школьной атмосферы  
- **Правая колонка:** Логотип + заголовок + поля Email/Password + кнопка "Войти" + ссылка "Забыли пароль?"
- **Интерактивность:** Кнопка "Войти" темнеет при hover
- **Переключатель тем:** Солнце/Луна в правом верхнем углу страницы

#### Анимированный лоадер (Сценарий 1, п.2):
- **Фон:** Темный
- **Анимация:** Контуры мозга и книги из логотипа, пульсирующие оранжевые линии
- **Текст:** "Загрузка..." под анимацией
- **Продолжительность:** Несколько секунд пока загружаются данные

### Пользовательские flow
#### Определение типа пользователя:
1. **Новый пользователь** → Экран "Инициация" 
2. **Незавершенный курс** → "Обучающий центр"
3. **Завершенный курс** → "Главный хаб" (полный доступ)

### Technical Implementation Notes
#### Supabase Auth Setup:
- Использовать `@supabase/auth-helpers-nextjs` для Next.js интеграции
- Auth state должен persist между sessions
- Email verification может потребоваться для production

#### Database Queries:
Для определения статуса пользователя нужны queries к:
- `User` table - базовая информация
- `UserCourseProgress` table - прогресс обучения

#### Theme Implementation:
- CSS variables для light/dark themes
- Persist theme choice в localStorage
- Theme provider с React Context

#### Error Handling:
- Использовать toast notifications для errors
- Поддерживающий тон согласно принципу "Поддерживающий и мотивирующий опыт"

### Dependencies
- `@supabase/supabase-js` - основной клиент
- `@supabase/auth-helpers-nextjs` - Next.js helpers  
- `lucide-react` - иконки для UI
- `react-hook-form` - форма с валидацией

### Testing

#### Test File Location
- Component tests: `src/components/auth/__tests__/`
- Integration tests: `tests/integration/auth/`
- E2E tests: `tests/e2e/auth-flow.spec.ts`

#### Testing Frameworks
- **Unit Testing:** Jest + React Testing Library
- **Integration Testing:** Jest + MSW (Mock Service Worker) для Supabase
- **E2E Testing:** Playwright для полного auth flow

#### Специфические требования для Auth Story

##### Unit Tests:
- LoginForm компонент (валидация, submit handling)
- ThemeToggle компонент (light/dark switching)
- AnimatedLoader компонент (анимация states)
- Error handling components

##### Integration Tests:
- Supabase Auth integration (login, logout, password reset)
- User status determination logic
- Navigation routing по типу пользователя
- Theme persistence across sessions

##### E2E Tests:
```javascript
// Пример E2E test structure
test('Complete new user auth flow', async ({ page }) => {
  // 1. Login page loads correctly
  // 2. Form validation works
  // 3. Successful login shows loader
  // 4. New user redirects to "Инициация"
  // 5. Theme toggle works throughout flow
});
```

#### Mock Strategy
- Mock Supabase Auth responses для consistent testing
- Test data factory для различных user states
- Visual regression tests для UI components

#### Coverage Requirements
- Auth components: 95% coverage (critical path)
- Integration points: 90% coverage
- Error scenarios: 100% coverage (все error states)

#### Test Data
```javascript
// User test fixtures
const mockUsers = {
  newUser: { id: '1', email: 'new@test.com', course_progress: null },
  inProgressUser: { id: '2', email: 'progress@test.com', course_completed: false },
  completedUser: { id: '3', email: 'done@test.com', course_completed: true }
};
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-25 | 1.0 | Initial story creation for authentication setup | Sarah (PO) |

## Dev Agent Record
_(This section is populated by the development agent during implementation)_

### Agent Model Used
_(Заполняется dev-agent)_

### Debug Log References
_(Заполняется dev-agent)_

### Completion Notes List
_(Заполняется dev-agent)_

### File List
_(Заполняется dev-agent)_

## QA Results
_(Results from QA Agent QA review of the completed story implementation)_