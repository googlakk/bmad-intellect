# Story 1.3: onboarding-screens

## Status
Approved

## Story
**As a** new teacher who just logged in for the first time,
**I want** to experience a welcoming and motivating onboarding sequence,
**so that** I understand the platform's purpose and feel prepared to start my learning journey

## Acceptance Criteria
1. Экран "Инициация" реализован с полностью безрамочным интерфейсом и виньетированием
2. Анимация пишущей машинки печатает приветственный текст с персонализацией имени пользователя
3. Имя пользователя выделено цветом и жирностью в приветственном тексте
4. Кнопка "Далее" появляется после завершения первой анимации
5. Второй анимированный текст объясняет необходимость обучения с выделенными ключевыми словами
6. Кнопка "Начать обучение" появляется в конце второй анимации
7. Экран "Разблокировка" появляется после завершения последнего теста курса
8. Анимированная нейросеть из светящихся линий отображается на фоне экрана "Разблокировка"
9. Текст "Инициализация завершена... Доступ к инструментам на базе ИИ разблокирован" анимируется
10. Ключевые слова в тексте разблокировки выделены цветом и стилем
11. Кнопка "Начать работу" перезагружает интерфейс и открывает полный доступ к платформе
12. Переходы между экранами плавные и соответствуют общему дизайну платформы

## Tasks / Subtasks
- [ ] Создание экрана "Инициация" (AC: 1, 2, 3, 4, 5, 6)
  - [ ] Реализовать безрамочный интерфейс с виньетированием
  - [ ] Создать компонент анимации пишущей машинки
  - [ ] Добавить персонализацию с именем пользователя
  - [ ] Реализовать выделение имени цветом и жирностью
  - [ ] Создать логику появления кнопки "Далее"
  - [ ] Добавить второй анимированный текст с выделением ключевых слов
  - [ ] Реализовать появление кнопки "Начать обучение"

- [ ] Создание экрана "Разблокировка" (AC: 7, 8, 9, 10, 11)
  - [ ] Реализовать безрамочный интерфейс с виньетированием (аналогично "Инициации")
  - [ ] Создать анимированную нейросеть из светящихся линий
  - [ ] Добавить анимацию текста "Инициализация завершена..."
  - [ ] Реализовать выделение ключевых слов в тексте разблокировки
  - [ ] Создать кнопку "Начать работу" с функцией перезагрузки интерфейса

- [ ] Интеграция с системой прогресса (AC: 7)
  - [ ] Создать триггер для показа экрана "Разблокировка"
  - [ ] Интегрировать с UserCourseProgress для определения завершения курса
  - [ ] Добавить проверку последнего теста в курсе

- [ ] Анимации и переходы (AC: 12)
  - [ ] Реализовать плавные переходы между экранами
  - [ ] Добавить CSS transitions для всех interactive элементов
  - [ ] Оптимизировать анимации для производительности
  - [ ] Протестировать анимации на разных устройствах

- [ ] Navigation логика
  - [ ] Настроить роутинг для экрана "Инициация"
  - [ ] Реализовать переход в обучающий центр после "Начать обучение"
  - [ ] Настроить переход в главный хаб после "Начать работу"
  - [ ] Добавить state management для onboarding статуса

- [ ] Responsive design и accessibility
  - [ ] Адаптировать под различные размеры экранов
  - [ ] Добавить keyboard navigation
  - [ ] Реализовать screen reader поддержку для анимаций
  - [ ] Протестировать с различными настройками accessibility

## Dev Notes

### Архитектурный контекст
- **UI Framework:** React + Next.js с focus на smooth animations
- **Animation Library:** Рекомендуется Framer Motion для complex animations
- **State Management:** Zustand для onboarding progress tracking
- **Типографика:** Merriweather для заголовков, sans-serif для основного текста

### UI/UX Requirements из front-end-spec.md

#### Экран "Инициация" (Сценарий 1, п.3):
- **Layout:** Полностью безрамочный интерфейс
- **Фон:** Эффект виньетирования (затемненные края)
- **Анимация 1:** 
  - Текст: "Добро пожаловать, **ИмяПользователя**..."
  - Эффект пишущей машинки
  - Имя выделено цветом и жирностью
- **Интеракция 1:** Появляется кнопка "Далее"
- **Анимация 2:** 
  - Объяснение необходимости обучения
  - Ключевые слова выделены цветом
- **Интеракция 2:** Появляется кнопка "Начать обучение"

#### Экран "Разблокировка" (Сценарий 1, п.5):
- **Layout:** Повторяет стиль "Инициации" - безрамочный с виньеткой
- **Фон:** Анимированная нейросеть из светящихся линий
- **Анимация:** 
  - Текст: "Инициализация завершена... Доступ к инструментам на базе ИИ **разблокирован**"
  - Ключевые слова ("разблокирован") выделены
- **Интеракция:** Кнопка "Начать работу" перезагружает интерфейс

### Technical Implementation

#### Animation Strategy:
```javascript
// Пример структуры для typewriter эффекта
const useTypewriter = (text, speed = 50) => {
  const [displayText, setDisplayText] = useState('');
  // Animation logic here
};
```

#### Color Palette для выделений:
- **Основной акцент:** Оранжево-бронзовый из brand palette
- **Нейросеть:** Светящиеся оранжевые линии
- **Фон виньетки:** Темно-синий с gradient

#### Database Integration:
Для определения onboarding статуса:
- `User.onboarding_completed` - флаг завершения инициации
- `UserCourseProgress.completed_at` - время завершения курса
- Логика: если completed_at !== null → показать "Разблокировку"

#### Performance Considerations:
- Lazy load анимированной нейросети
- Debounce typewriter animations
- Use `will-change` CSS для animated элементов
- Optimize SVG для нейросети (или использовать Canvas)

#### Navigation Flow:
1. **Auth Success** → "Анимированный лоадер" → "Инициация"
2. **"Начать обучение"** → redirect to `/learning-center`
3. **Course Completion** → trigger "Разблокировка" screen
4. **"Начать работу"** → redirect to `/dashboard` + set `onboarding_completed = true`

### Dependencies
- `framer-motion` - для комплексных анимаций
- `react-use` - для custom hooks (useLocalStorage, etc.)
- CSS-in-JS library или CSS Modules для styled components

### Accessibility Notes
- `role="status"` для animated text updates
- `aria-live="polite"` для screen readers
- Skip animation опция для users с motion sensitivity
- High contrast mode поддержка для выделенных элементов

### Testing

#### Test File Location
- Component tests: `src/components/onboarding/__tests__/`
- Integration tests: `tests/integration/onboarding/`
- E2E tests: `tests/e2e/onboarding-flow.spec.ts`

#### Testing Frameworks
- **Unit Testing:** Jest + React Testing Library
- **Animation Testing:** Jest + @testing-library/user-event для interaction
- **E2E Testing:** Playwright для полного onboarding flow

#### Специфические требования для Onboarding Story

##### Unit Tests:
- InitiationScreen компонент (typewriter animation, персонализация)
- UnlockScreen компонент (нейросеть анимация, text highlighting)
- TypewriterEffect hook (timing, text progression)
- HighlightText компонент (color styling, keyword detection)

##### Animation Testing Strategy:
```javascript
// Пример тестирования typewriter эффекта
test('typewriter animation completes correctly', async () => {
  render(<InitiationScreen userName="TestUser" />);
  
  // Проверить начальное состояние
  expect(screen.getByText('')).toBeInTheDocument();
  
  // Дождаться завершения анимации
  await waitFor(() => {
    expect(screen.getByText(/Добро пожаловать, TestUser/)).toBeInTheDocument();
  }, { timeout: 3000 });
  
  // Проверить появление кнопки
  expect(screen.getByRole('button', { name: 'Далее' })).toBeInTheDocument();
});
```

##### Integration Tests:
- Onboarding flow с database integration
- User progress tracking (onboarding_completed flag)
- Navigation между экранами
- Theme persistence через onboarding

##### E2E Tests:
```javascript
test('Complete onboarding journey', async ({ page }) => {
  // 1. New user после auth попадает на "Инициацию"
  // 2. Typewriter анимация работает
  // 3. Кнопка "Далее" появляется и работает
  // 4. Второй текст анимируется
  // 5. Кнопка "Начать обучение" ведет в learning center
  // 6. После завершения курса показывается "Разблокировка"
  // 7. "Начать работу" ведет в dashboard
});
```

##### Accessibility Testing:
- Screen reader compatibility для анимированного текста
- Keyboard navigation для всех interactive элементов
- Reduced motion preference respect
- High contrast mode поддержка

##### Performance Testing:
- Animation frame rate monitoring
- Memory usage для комплексных SVG анимаций
- Load time для heavy animation assets
- Mobile device performance validation

#### Mock Strategy
- Mock user data для персонализации
- Mock animation timings для deterministic tests
- Mock navigation для isolated component testing

#### Coverage Requirements
- Animation components: 90% coverage
- Integration flows: 95% coverage (critical for UX)
- Accessibility features: 100% coverage

#### Visual Regression Tests
```javascript
// Пример Playwright visual testing
test('onboarding screens visual consistency', async ({ page }) => {
  await page.goto('/onboarding/initiation');
  await expect(page).toHaveScreenshot('initiation-screen.png');
  
  // After animation completes
  await page.waitForTimeout(2000);
  await expect(page).toHaveScreenshot('initiation-complete.png');
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-25 | 1.0 | Initial story creation for onboarding screens | Sarah (PO) |

## Dev Agent Record
_(This section is populated by the development agent during implementation)_

### Agent Model Used
_(Заполняется dev-agent)_

### Debug Log References
_(Заполняется dev-agent)_

### Completion Notes List
_(Заполняется dev-agent)_

### File List
_(Заполняется dev-agent)_

## QA Results
_(Results from QA Agent QA review of the completed story implementation)_